<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>&#x202A;Krd firmware: &#x202A;Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="kineis_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">&#x202A;Krd firmware
   &#160;<span id="projectnumber">&#x202A;v10.0.1</span>
   </div>
   <div id="projectbrief">&#x202A;Firmware application for Kinéis reference design project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc PageDocLTR-title"><div class="header">
  <div class="headertitle">
<div class="title">Krd firmware Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p class="DocNodeLTR"><a class="anchor" id="md_Kineis_README"></a> This is package is releasing the Kinéis Stack SW library with two demo-application examples (standalone or AT commands) on a STM32WL55xx-based HW reference design (KRD_MP).</p>
<p class="DocNodeLTR">One demo app can be compiled at the same time. You can choose it by changing the Makefile's APP variable to GUI or STDLN. </p><div class="fragment"><div class="line"><span class="preprocessor"># Select APPlication. Can be:</span></div>
<div class="line"><span class="preprocessor"># * STDLN: for the standalone application sending one message at startup</span></div>
<div class="line"><span class="preprocessor"># * GUI: for the application using the AT commands from UART link</span></div>
<div class="line"><span class="preprocessor">APP = STDLN</span></div>
</div><!-- fragment --><p class="DocNodeLTR">By default, this package compiles the standalone APP, starting to send one user message immediately with the MAC BASIC profile. This will lead to:</p><ul class="DocNodeLTR">
<li>&#x202A;start kineis stack MAC profile BASIC</li>
<li>&#x202A;transmit A message once immediately</li>
<li>&#x202A;close the kineis stack MAC profile</li>
<li>&#x202A;The device goes into LPM shutdown then</li>
</ul>
<p class="DocNodeLTR">By changing the Makefile's MAC_PRFL variable to BLIND, the standalone application will re-transmit the message several times as per profile's configuration in a way to reach some expected QoS.</p><ul class="DocNodeLTR">
<li>&#x202A;start kineis stack MAC profile BLIND</li>
<li>&#x202A;4 retransmissions of this messages each 60s</li>
<li>&#x202A;The device goes into LPM standby between each retx</li>
<li>&#x202A;close the kineis stack MAC profile</li>
<li>&#x202A;Once all retransmissions are completed, the device goes to LPM shutdown</li>
</ul>
<p class="DocNodeLTR">Refer also to the <a class="el" href="db/d5a/kns_app_page.html">APP task</a> for extra details about the applications.</p>
<p class="DocNodeLTR">The kineis stack is meant to be integrated in an OS-like environment supporting LPM. In this package, you will find:</p>
<ul class="DocNodeLTR">
<li>&#x202A;the application is embedded in a task</li>
<li>&#x202A;the kineis stack is embedded in another task</li>
<li>&#x202A;a third task (very-low priority IDLE task) is used to enter in low power mode once the others task becomes inactive.</li>
</ul>
<h1 class="DocNodeLTR"><a class="anchor" id="autotoc_md2"></a>
Getting started: configuration</h1>
<h2 class="DocNodeLTR"><a class="anchor" id="autotoc_md3"></a>
Credentials managment</h2>
<p class="DocNodeLTR">This kineis stack needs some credentials (ID, address, secret key) to run properly.</p>
<dl class="section attention DocNodeLTR"><dt>Attention</dt><dd>&#x202A;Please contact Kinéis to get your own credentials file</dd>
<dd>
&#x202A;Credentials are delivered by Kineis after certificication of your device</dd>
<dd>
&#x202A;Once credentials are delivered by Kineis, it becomes your responsability</dd></dl>
<p class="DocNodeLTR">It is up to the integrator to store it as per its own security strategy. The kineis stack is just requesting them through APIs called MCU_NVM wrapper (<a class="el" href="d6/d2f/mcu__nvm_8c.html" title="&#x202A;MCU wrapper for any access to the non volatile memory accesses.">mcu_nvm.c</a>):</p>
<ul class="DocNodeLTR">
<li>&#x202A;"get device ID" and "get device address" are said not to be critical from a security point of view. Thus it remains visible when the API is called</li>
<li>&#x202A;"AES init" and "AES encrypt" are used to build the frame which is transmitted over the air. <dl class="section note DocNodeLTR"><dt>Note</dt><dd>&#x202A;Here Kineis stack never knows the secret key.</dd></dl>
&#x202A;In this package, the credentials are just hardcoded in the code, meaning clearly stored in RAM/FLASH without any protections. One can change the code of these wrappers to fit its security strategy (e.g. set the secret key directly in some AES HW module or secure element).</li>
</ul>
<h2 class="DocNodeLTR"><a class="anchor" id="autotoc_md4"></a>
Radio configuration managment</h2>
<p class="DocNodeLTR">This FW package needs some radio configuration (transmission frequency range, transmission modulation, ...) to run properly.</p>
<dl class="section attention DocNodeLTR"><dt>Attention</dt><dd>&#x202A;Please contact Kinéis to get your own radio configuration binary file when you will deploy your devices.</dd></dl>
<p class="DocNodeLTR">It is up to you to handle how to store those informations in the devices. The kineis stack is just requesting them through one API.</p>
<p class="DocNodeLTR">In this package, the configuration binary file is just hardcoded in the code as a table of bytes in <a class="el" href="d6/d2f/mcu__nvm_8c.html" title="&#x202A;MCU wrapper for any access to the non volatile memory accesses.">mcu_nvm.c</a>. You will get several examples of it. You can comment, uncomment the one you want.</p>
<dl class="section note DocNodeLTR"><dt>Note</dt><dd>&#x202A;In case of GUI APP, it is also possible to change the radio configuration through the AT command "AT+RCONF" (<a class="el" href="d0/d0f/group___m_g_r___a_t___c_m_d.html#gaf2dc4b8c03924fc01641182032c31ba5">bMGR_AT_CMD_RCONF_cmd</a>)</dd></dl>
<p class="DocNodeLTR">All the Kineis Stack needs is to be able to get the radio configuration at initialization.</p>
<dl class="section note DocNodeLTR"><dt>Note</dt><dd>&#x202A;In case the user application needs to change the radio configuration on the fly, Kineis Stack needs to be stopped, then restarted.</dd></dl>
<h2 class="DocNodeLTR"><a class="anchor" id="autotoc_md5"></a>
MAC profile configuration managment</h2>
<p class="DocNodeLTR">The Kineis MAC protocols (a.k.a. profiles) can be tuned according to the device capabilities and user's application needs, such as:</p>
<ul class="DocNodeLTR">
<li>&#x202A;Timer capabilities</li>
<li>&#x202A;Kineis service subscription</li>
</ul>
<p class="DocNodeLTR">So far, it may be possible to choose between two different protocols:</p>
<ul class="DocNodeLTR">
<li>&#x202A;BASIC: Transmit the user message once immediately. Here the QoS is not guaranteed</li>
<li>&#x202A;BLIND: The user message will be re-transmitted several times periodically in a way to guarantee some QoS</li>
</ul>
<dl class="section attention DocNodeLTR"><dt>Attention</dt><dd>&#x202A;Please contact Kinéis to get configuration for your profile when you will deploy your devices.</dd></dl>
<p class="DocNodeLTR">so far, you can choose the protocol by changing Makefile variable MAC_PRFL:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># Select Kineis stack MAC profile. Can be:</span></div>
<div class="line"><span class="preprocessor"># * BASIC: basic profile, sending message once immediately </span></div>
<div class="line"><span class="preprocessor"># * BLIND: blind profile, sending message sevral times periodically </span></div>
<div class="line"><span class="preprocessor">MAC_PRFL = BASIC</span></div>
</div><!-- fragment --><p class="DocNodeLTR">Then, once the protocol is chosen, some specific configuration may be tuned. Regarding BLIND protocol, refer to KNS_MAC_BLIND_usrCfg_t in <a class="el" href="d4/d0d/kns__app_8c.html">kns_app.c</a>:</p>
<ul class="DocNodeLTR">
<li>&#x202A;number of repetitions</li>
<li>&#x202A;repetition period</li>
</ul>
<h1 class="DocNodeLTR"><a class="anchor" id="autotoc_md6"></a>
Getting started: entry point</h1>
<h2 class="DocNodeLTR"><a class="anchor" id="autotoc_md7"></a>
main</h2>
<p class="DocNodeLTR">The entry point of this package is the main function.</p>
<p class="DocNodeLTR">Cf dedicated page here <a class="el" href="dc/d3f/main_page.html">Entry point: main</a> for all the details.</p>
<h2 class="DocNodeLTR"><a class="anchor" id="autotoc_md8"></a>
OS</h2>
<p class="DocNodeLTR">The OS embedded in this package is the "Kineis baremetal OS" which has very minimalist footprint. Behind the "queue create" and "task register" APIs, all is actually statically declared ( cf <a class="el" href="d2/dae/kns__q__conf_8c.html" title="&#x202A;Configuration of queues used in kineis_swr.">kns_q_conf.c</a>, <a class="el" href="d8/dd1/kns__q__conf_8h.html" title="&#x202A;Configuration of queues used in kineis_sw.">kns_q_conf.h</a>, <a class="el" href="d6/d73/kns__os__conf_8h.html" title="&#x202A;Configuration of task used with/in kineis_sw.">kns_os_conf.h</a> files in <a class="el" href="dir_b8b18822a774fad16818b672d6e0daf5.html">Kineis/Extdep/Conf</a> folder).</p>
<p class="DocNodeLTR">The purpose here, is to show the "KNS_OS..." and "KNS_Q..." abstraction APIs internally used by the Kineis stack. An integrator can use its own OS, by adapting the "KNS_OS..." and "KNS_Q..." source code to it.</p>
<dl class="section attention DocNodeLTR"><dt>Attention</dt><dd>&#x202A;Take care the Kineis task is actually polling 3 queues in loop. Ensure your implementation of KNS_Q push/pop is not waiting indefinitively on a a single queue.</dd></dl>
<p class="DocNodeLTR"><a class="el" href="df/d26/kns_os_page.html">OS abstraction layer for Kinéis</a></p>
<h1 class="DocNodeLTR"><a class="anchor" id="autotoc_md9"></a>
Package content</h1>
<p class="DocNodeLTR">All Kinéis related informations are located in <code>Kineis</code> folder. Typical source tree looks like below.</p>
<h2 class="DocNodeLTR"><a class="anchor" id="autotoc_md10"></a>
View</h2>
<div class="fragment"><div class="line">.</div>
<div class="line">├── App</div>
<div class="line">│   ├── Kineis_os</div>
<div class="line">│   │   ├── KNS_OS</div>
<div class="line">│   │   │   ├── Inc</div>
<div class="line">│   │   │   │   └── kns_os.h</div>
<div class="line">│   │   │   └── Src</div>
<div class="line">│   │   │       └── kns_os.c</div>
<div class="line">│   │   └── KNS_Q</div>
<div class="line">│   │       ├── Inc</div>
<div class="line">│   │       │   └── kns_q.h</div>
<div class="line">│   │       └── Src</div>
<div class="line">│   │           ├── kns_q_baremetal.c</div>
<div class="line">│   │           ├── kns_q.c</div>
<div class="line">│   │           ├── kns_q_cmsis_os2.c</div>
<div class="line">│   │           └── kns_q_freertos.c</div>
<div class="line">│   ├── kns_app.c</div>
<div class="line">│   ├── kns_app.h</div>
<div class="line">│   ├── Libs</div>
<div class="line">│   │   ├── STRUTIL</div>
<div class="line">│   │   │   ├── Inc</div>
<div class="line">│   │   │   │   └── strutil_lib.h</div>
<div class="line">│   │   │   └── Src</div>
<div class="line">│   │   │       └── strutil_lib.c</div>
<div class="line">│   │   └── USERDATA</div>
<div class="line">│   │       ├── Inc</div>
<div class="line">│   │       │   └── user_data.h</div>
<div class="line">│   │       └── Src</div>
<div class="line">│   │           └── user_data.c</div>
<div class="line">│   ├── Managers</div>
<div class="line">│   │   └── MGR_AT_CMD</div>
<div class="line">│   │       ├── Inc</div>
<div class="line">│   │       │   ├── mgr_at_cmd_common.h</div>
<div class="line">│   │       │   ├── mgr_at_cmd.h</div>
<div class="line">│   │       │   ├── mgr_at_cmd_list_certif.h</div>
<div class="line">│   │       │   ├── mgr_at_cmd_list_general.h</div>
<div class="line">│   │       │   ├── mgr_at_cmd_list.h</div>
<div class="line">│   │       │   ├── mgr_at_cmd_list_mac.h</div>
<div class="line">│   │       │   ├── mgr_at_cmd_list_previpass.h</div>
<div class="line">│   │       │   └── mgr_at_cmd_list_user_data.h</div>
<div class="line">│   │       └── Src</div>
<div class="line">│   │           ├── mgr_at_cmd.c</div>
<div class="line">│   │           ├── mgr_at_cmd_common.c</div>
<div class="line">│   │           ├── mgr_at_cmd_list.c</div>
<div class="line">│   │           ├── mgr_at_cmd_list_certif.c</div>
<div class="line">│   │           ├── mgr_at_cmd_list_general.c</div>
<div class="line">│   │           ├── mgr_at_cmd_list_mac.c</div>
<div class="line">│   │           ├── mgr_at_cmd_list_previpass.c</div>
<div class="line">│   │           └── mgr_at_cmd_list_user_data.c</div>
<div class="line">│   └── Mcu</div>
<div class="line">│       ├── Inc</div>
<div class="line">│       │   └── mcu_at_console.h</div>
<div class="line">│       └── Src</div>
<div class="line">│           ├── mcu_at_console.c</div>
<div class="line">│           └── mcu_at_console_stm.c</div>
<div class="line">├── Appconf</div>
<div class="line">│   ├── kns_app_conf.h</div>
<div class="line">│   ├── kns_os_conf.h</div>
<div class="line">│   └── mgr_log_conf.h</div>
<div class="line">├── Doc</div>
<div class="line">│   ├── krd_fw</div>
<div class="line">│   │   ├── doc_version.txt</div>
<div class="line">│   │   └── html</div>
<div class="line">│   │       ├── index.html</div>
<div class="line">│   ├── libkineis</div>
<div class="line">│   │   ├── doc_version.txt</div>
<div class="line">│   │   └── html</div>
<div class="line">│   │       ├── index.html</div>
<div class="line">│   └── libknsrf_wl</div>
<div class="line">│       ├── doc_version.txt</div>
<div class="line">│       └── html</div>
<div class="line">│   │       ├── index.html</div>
<div class="line">├── doxy_warn_log_file.txt</div>
<div class="line">├── Extdep</div>
<div class="line">│   ├── Conf</div>
<div class="line">│   │   ├── kineis_sw_conf.h</div>
<div class="line">│   │   ├── kns_assert.c</div>
<div class="line">│   │   ├── kns_assert.h</div>
<div class="line">│   │   ├── kns_cs.c</div>
<div class="line">│   │   ├── kns_cs.h</div>
<div class="line">│   │   ├── kns_q_conf.c</div>
<div class="line">│   │   └── kns_q_conf.h</div>
<div class="line">│   ├── Mcu</div>
<div class="line">│   │   ├── Inc</div>
<div class="line">│   │   │   ├── aes.h</div>
<div class="line">│   │   │   ├── mcu_aes.h</div>
<div class="line">│   │   │   ├── mcu_misc.h</div>
<div class="line">│   │   │   ├── mcu_nvm.h</div>
<div class="line">│   │   │   └── mcu_tim.h</div>
<div class="line">│   │   └── Src</div>
<div class="line">│   │       ├── aes.c</div>
<div class="line">│   │       ├── mcu_aes.c</div>
<div class="line">│   │       ├── mcu_misc.c</div>
<div class="line">│   │       ├── mcu_nvm.c</div>
<div class="line">│   │       └── mcu_tim.c</div>
<div class="line">│   └── MGR_LOG</div>
<div class="line">│       ├── Inc</div>
<div class="line">│       │   ├── mgr_log.h</div>
<div class="line">│       │   └── mgr_log_rtc.h</div>
<div class="line">│       └── Src</div>
<div class="line">│           ├── mgr_log.c</div>
<div class="line">│           └── mgr_log_rtc.c</div>
<div class="line">├── Lib</div>
<div class="line">│   ├── kns_cfg.h</div>
<div class="line">│   ├── kns_glossary.h</div>
<div class="line">│   ├── kns_mac_evt.h</div>
<div class="line">│   ├── kns_mac.h</div>
<div class="line">│   ├── kns_mac_prfl_cfg.h</div>
<div class="line">│   ├── kns_rf.h</div>
<div class="line">│   ├── kns_srvc_common.h</div>
<div class="line">│   ├── kns_types.h</div>
<div class="line">│   ├── libkineis.a</div>
<div class="line">│   ├── libkineis_info.c</div>
<div class="line">│   ├── libkineis_info.h</div>
<div class="line">│   ├── libkineis_undefined_symbols.txt</div>
<div class="line">│   ├── libknsrf_wl.a</div>
<div class="line">│   ├── libknsrf_wl_info.c</div>
<div class="line">│   ├── libknsrf_wl_info.h</div>
<div class="line">│   └── libknsrf_wl_undefined_symbols.txt</div>
<div class="line">├── Lpm</div>
<div class="line">│   ├── Inc</div>
<div class="line">│   │   ├── lpm_cli_kstk.h</div>
<div class="line">│   │   ├── lpm.h</div>
<div class="line">│   │   └── mgr_lpm.h</div>
<div class="line">│   └── Src</div>
<div class="line">│       ├── lpm.c</div>
<div class="line">│       ├── lpm_cli_kstk.c</div>
<div class="line">│       └── mgr_lpm.c</div>
<div class="line">├── README.md</div>
<div class="line">└── version.txt</div>
</div><!-- fragment --><h2 class="DocNodeLTR"><a class="anchor" id="autotoc_md11"></a>
Description</h2>
<p class="DocNodeLTR"><b>App</b> folder contains some generic code for:</p>
<ul class="DocNodeLTR">
<li><p class="startli DocNodeLTR"><b>Kineis_os</b> contains the Kineis baremetal OS used to register queues and tasks.</p>
<p class="startli DocNodeLTR">The APPlications task containing demos mentioned earlier (<a class="el" href="d4/d0d/kns__app_8c.html">kns_app.c</a>). The GUI app relies on an AT command manager.</p>
</li>
<li><p class="startli DocNodeLTR"><b>Managers/MGR_AT_CMD</b> contains the AT command manager used by the GUI application.</p>
<p class="startli DocNodeLTR">It is about parsing a ASCII data stream coming from UART driver.</p>
<p class="startli DocNodeLTR">Entry point of this manager is <a class="el" href="d2/db5/mgr__at__cmd_8h.html" title="&#x202A;AT commands manager main header file.">mgr_at_cmd.h</a>.</p>
<p class="startli DocNodeLTR"><a class="el" href="df/d01/mgr__at__cmd__list_8h.html" title="&#x202A;AT commands list header file.">mgr_at_cmd_list.h</a> is the entry file referencing the AT cmds supported by this firmware. Then, the other mgr_at_cmd_list files refers to subsets of AT cmds per functionnalities (such as general, user_data). General subset is to get ID or firmware version. User data subset is to transmit data over the air. <br  />
</p>
</li>
<li>&#x202A;<b>Libs/STRUTIL</b> and <b>Libs/USERDATA</b> are pure sw libraries (no HW dependencies) used in AT cmd manager.</li>
<li><p class="startli DocNodeLTR"><b>Mcu</b> contains low level hardware drivers (called wrappers) used by the components above.</p>
<p class="startli DocNodeLTR">Typically, it contains the wrapper used to handle a terminal/console to post/receive AT cmds (<a class="el" href="d4/d30/mcu__at__console_8h.html" title="&#x202A;MCU wrapper for AT CMD console.">mcu_at_console.h</a>).</p>
<dl class="section note DocNodeLTR"><dt>Note</dt><dd>&#x202A;So far, this at_cmd console wrapper is derived from STM32_HAL_UART drivers.</dd></dl>
<p class="DocNodeLTR">This is actually an UART driver changed to handle a continuous ACII data stream. It may be optimized as your convenience or based on STM LL drivers instead. Each time a character is received on UART, it is invoking a stream-parsing callback (so far <a class="el" href="d0/d0f/group___m_g_r___a_t___c_m_d.html#ga8a8d9cacd2053d0c96e923fc183ac4ad">MGR_AT_CMD_parseStreamCb</a> in this package).</p>
</li>
</ul>
<p class="DocNodeLTR"><b>Appconf</b> folder contains the static configurations which are specific to</p>
<ul class="DocNodeLTR">
<li>&#x202A;This package</li>
<li>&#x202A;This microcontroller (STM32WL55xx)</li>
</ul>
<p class="DocNodeLTR"><b>Extdep</b> folder contains external dependencies of the stack. So far, it is about</p>
<ul class="DocNodeLTR">
<li><p class="startli DocNodeLTR"><b>Conf</b> contains static configurations used by the entire project.</p>
<p class="startli DocNodeLTR">As mentionned earlier, you will find here all things concerning OS task and Queue definitions. There is also some utilities to catch the asserts of the kineis stack and to implement critical sections.</p>
</li>
<li><p class="startli DocNodeLTR"><b>Mcu</b> contains low level hardware drivers (called wrappers) used by the kineis stack library.</p>
<p class="startli DocNodeLTR">This is about AES (<a class="el" href="d7/de1/mcu__aes_8c.html" title="&#x202A;MCU wrapper for encryption/decryption wrappers utilities.">mcu_aes.c</a>), credentials (<a class="el" href="d6/d2f/mcu__nvm_8c.html" title="&#x202A;MCU wrapper for any access to the non volatile memory accesses.">mcu_nvm.c</a>), extra drivers such as external PA (<a class="el" href="df/ddf/mcu__misc_8c.html" title="&#x202A;File to implement miscellaneous features for a specific design.">mcu_misc.c</a>). The integrator is expected to implement its own version of those wrappers as per his platform/HW needs. By default, this package is delivering a simple template of each wrapper.</p>
</li>
<li><p class="startli DocNodeLTR"><b>MGR_LOG</b> The logger (a.k.a logging manager in <a class="el" href="d2/d2e/mgr__log_8h.html" title="&#x202A;logger main header file">mgr_log.h</a>) used by the library to log important informations during execution.</p>
<dl class="section note DocNodeLTR"><dt>Note</dt><dd>&#x202A;In typical package delivery the kineis stack is compiled without debug info. This actually contains empty macros.</dd></dl>
<p class="DocNodeLTR">So far, this logger is also used by the application software described later below</p>
</li>
</ul>
<p class="DocNodeLTR"><b>Lpm</b> contains all code related to the support of low power on this microcontroller (STM32WL55xx) with interactionto the kineis stack task and the application task.</p>
<ul class="DocNodeLTR">
<li>&#x202A;<a class="el" href="df/db7/lpm_8h.html" title="&#x202A;This file contains some utilities and functions needed for a correct handling of LPM on the STM32WL55...">lpm.h</a> is the entry point for low power managment. It does the bridge between generic lpm_mgr and STM32WL55xx's specifics</li>
<li>&#x202A;<a class="el" href="df/d63/mgr__lpm_8h.html" title="&#x202A;low power mode manager is in charge to collect all low power needs from &#39;clients&#39; and setup the corre...">mgr_lpm.h</a> is the generic part of LPM managment. Tthis code can be ported on any other uC.</li>
<li>&#x202A;lpm_cli refers to "LPM clients" such as the <a class="el" href="df/da4/lpm__cli__kstk_8h.html" title="&#x202A;Kineis stack&#39;s LPM client. It is implementing APIs needed to interface with the low power manager (MG...">lpm_cli_kstk.h</a>, which is the Kineis stack LPM client. This code actually converts the Kineis stack ressource status (KNS_MAC_getRsrcStatus) into low power mode supported by this plateform (MgrLpm_LPM_t)</li>
</ul>
<p class="DocNodeLTR"><b>Lib</b> Contains some Kineis libraries and its APIs</p>
<ul class="DocNodeLTR">
<li>&#x202A;libkineis.a is the kineis stack libraries <a href="&#x202A;../../../../../Doc/libkineis/html/index.html">doc link</a></li>
<li>&#x202A;libknsrf_wl.a contains the RF driver for the STM32WL55xx uC <a href="&#x202A;../../../../../Doc/libknsrf_wl/html/index.html">doc link</a></li>
<li>&#x202A;top-APIs and bottow-APIs are present through the header files</li>
</ul>
<p class="DocNodeLTR"><b>version.txt</b> file contains references to the software version of the package</p>
<h1 class="DocNodeLTR"><a class="anchor" id="autotoc_md12"></a>
How to build</h1>
<p class="DocNodeLTR">This project is based on makefiles. It is possible to invoke it from IDE or from console then.</p>
<h2 class="DocNodeLTR"><a class="anchor" id="autotoc_md13"></a>
From STM32CubeIDE</h2>
<h3 class="DocNodeLTR"><a class="anchor" id="autotoc_md14"></a>
Open package in IDE</h3>
<p class="DocNodeLTR">Install STM32CubeIDE and open project present in the Kinéis package. Toolchain (GCC, GNU Make) should direcly come up with your installation.</p>
<p class="DocNodeLTR">Present package was tested with following STM32CubeIDE v1.10.1 on windows 10. Present package was tested with following STM32CubeIDE v1.18.0 on Linux</p>
<p class="DocNodeLTR">Once STM32CubeIDE is properly installed:</p>
<ul class="DocNodeLTR">
<li>&#x202A;Go to following menu: <code>File &gt; Open Projects from File System...</code></li>
<li>&#x202A;In popped-up windows<ul class="DocNodeLTR">
<li>&#x202A;Click on <code>Archive...</code> button in a way to select Kinéis .tar .gz archive of this package (should be named something like <code>krd_fw_package_.*.tar.gz</code>.</li>
<li>&#x202A;Click on <code>Open</code></li>
<li>&#x202A;Let STM32CubeIDE parse the package once <code>Folder</code> sub-window shows items</li>
<li>&#x202A;In this <code>Folder</code> sub-windows, select only the found <code>Eclipse project</code></li>
<li>&#x202A;Click on <code>Finish</code>. <code>krd_fw</code> project should open and be available in <code>Project Explorer</code> panel</li>
</ul>
</li>
<li>&#x202A;In <code>Project Explorer</code> panel, you can select the <code>krd_fw</code> project. It should open properly.</li>
</ul>
<h3 class="DocNodeLTR"><a class="anchor" id="autotoc_md15"></a>
Build</h3>
<dl class="section attention DocNodeLTR"><dt>Attention</dt><dd>&#x202A;You always need to <b>clean the build before any rebuild</b></dd></dl>
<p class="DocNodeLTR">Right click on project and select <code>Clean Project</code> to clean all. In build console, you should see something like:</p>
<div class="fragment"><div class="line">make clean </div>
<div class="line">rm -fR build</div>
<div class="line">...</div>
</div><!-- fragment --><p class="DocNodeLTR">Right click on project and select <code>Build Project</code> to build. you should see something like: </p><div class="fragment"><div class="line">make all </div>
<div class="line">mkdir -p build</div>
<div class="line">arm-none-eabi-gcc ...</div>
</div><!-- fragment --><p class="DocNodeLTR">Binary file <code>krd_fw.elf</code> file should be present in <code>build</code> folder of the project and ready to be flashed in KRD_MP HW.</p>
<h2 class="DocNodeLTR"><a class="anchor" id="autotoc_md16"></a>
From terminal</h2>
<p class="DocNodeLTR">This project was tested and validated with following toolchain </p><div class="fragment"><div class="line">GNU Make 4.4.1_st_20231030-1220</div>
<div class="line">Built for x86_64-pc-linux-gnu</div>
<div class="line">Copyright (C) 1988-2023 Free Software Foundation, Inc.</div>
<div class="line">License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;</div>
<div class="line">This is free software: you are free to change and redistribute it.</div>
<div class="line">There is NO WARRANTY, to the extent permitted by law.</div>
</div><!-- fragment --> <div class="fragment"><div class="line">arm-none-eabi-gcc (GNU Tools for STM32 12.3.rel1.20240926-1715) 12.3.1 20230626</div>
<div class="line">Copyright (C) 2022 Free Software Foundation, Inc.</div>
<div class="line">This is free software; see the source for copying conditions.  There is NO</div>
<div class="line">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</div>
</div><!-- fragment --><p class="DocNodeLTR">In a way to build same binary from STM32CubeIDE or console whenever you are in windows or linux, it is recommended to point on same toolchain coming-up with STM32CubeIDE installation. You may need to update your PATH variable to point on this toolchain.</p>
<ul class="DocNodeLTR">
<li>&#x202A;Linux: Depending on you IDE/toolchain version, add something like following in your ~/.bashrc <div class="fragment"><div class="line">export PATH=/opt/st/stm32cubeide_1.17.0/plugins/com.st.stm32cube.ide.mcu.externaltools.gnu-tools-for-stm32.12.3.rel1.linux64_1.1.0.202410170702/tools/bin/:$PATH</div>
<div class="line">export PATH=/opt/st/stm32cubeide_1.17.0/plugins/com.st.stm32cube.ide.mcu.externaltools.make.linux64_2.2.0.202409170845/tools/bin/:$PATH</div>
</div><!-- fragment --></li>
<li>&#x202A;Windows: Update System PATH variable as usual.</li>
</ul>
<h3 class="DocNodeLTR"><a class="anchor" id="autotoc_md17"></a>
Build</h3>
<dl class="section attention DocNodeLTR"><dt>Attention</dt><dd>&#x202A;You need to <b>clean the current build before any rebuild</b></dd></dl>
<p class="DocNodeLTR">Once toolchain is correctly available, go to root directory of the package and run following commands to build for default HW</p>
<div class="fragment"><div class="line">make clean</div>
<div class="line">make</div>
</div><!-- fragment --><p class="DocNodeLTR"> Binary file <code>*.elf</code> file should be present in <code>build</code> folder of the project and ready to be flashed in KRD_MP HW.</p>
<h2 class="DocNodeLTR"><a class="anchor" id="autotoc_md18"></a>
Compilation flags (log level, LPM level, ...)</h2>
<p class="DocNodeLTR">The makefile contains several compilation flags which can be changed as per your convinience:</p>
<div class="fragment"><div class="line">DEBUG = 1             # enable/disable log with debug level</div>
<div class="line">VERBOSE = 0           # enable/disable log with verbose level (impacts real-time)</div>
<div class="line">USE_BAREMETAL = 1     # compile with/without kineis baremetal OS</div>
<div class="line">APP = STDLN           # compile standalone or AT-cmd-like application</div>
<div class="line">MAC_PRFL = BASIC      # compile stabdalone application with BASIC/BLIND profile (Note this is useless in case of GUI application)</div>
<div class="line">LPM = SHUTDOWN        # deeepest low power mode allowed, can be: NONE, SLEEP, STOP, STANDBY, SHUTDOWN</div>
<div class="line">KRD_BOARD = KRD_FW_MP # KRD board HW type, choose between: KRD_FW_LP, KRD_FW_MP</div>
</div><!-- fragment --><h1 class="DocNodeLTR"><a class="anchor" id="autotoc_md19"></a>
Doc</h1>
<p class="DocNodeLTR">Documentation folder is containing doxygen auto-generated documentation. Read html documentation by opening index.html files present in sub-folders of <code>Kineis/Doc/..</code> with a web browser. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
