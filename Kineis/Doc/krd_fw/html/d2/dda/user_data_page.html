<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>&#x202A;Krd firmware: &#x202A;User data Library</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../kineis_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">&#x202A;Krd firmware
   &#160;<span id="projectnumber">&#x202A;v9.1.2</span>
   </div>
   <div id="projectbrief">&#x202A;Firmware application for Kin√©is reference design project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d2/dda/user_data_page.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc PageDocLTR-title"><div class="header">
  <div class="headertitle">
<div class="title">&#x202A;User data Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p class="DocNodeLTR">This page is presenting the USER DATA Library.</p>
<p class="DocNodeLTR">This software library handles user data. It is a central component in charge to:</p><ul class="DocNodeLTR">
<li>&#x202A;get free memory and store user data coming from high layers (AT commands, sensors, ...)</li>
<li>&#x202A;provide it to several lower RF layer which will transmit it over the air (e.g. ARGOS, LoRa, NB-IOT, ...).</li>
</ul>
<p class="DocNodeLTR">Typically, the higher layer can be an AT command manager and the lower layer can be some network manager (NW MGR) in charge to transmit and receive data over the air. In case of hybridation, the lower layer could be a network manager which will decide on which network it is worth to transmit first.</p>
<h1 class="DocNodeLTR"><a class="anchor" id="user_data_design_apis"></a>
APIs</h1>
<p class="DocNodeLTR">The APIs proposed by this library are about to:</p><ul class="DocNodeLTR">
<li>&#x202A;add a new message at the beginning or at the end of the FIFO</li>
<li>&#x202A;remove an element</li>
<li>&#x202A;count the number of message already located in the FIFO</li>
<li>&#x202A;count the remaining free place in FIFO</li>
<li>&#x202A;get next free memory element</li>
<li>&#x202A;get first element of the FIFO</li>
<li>&#x202A;flush the entire FIFO</li>
<li>&#x202A;Retrieve an element of the FIFO</li>
</ul>
<p class="DocNodeLTR">When an element is transmitted, the lower layer needs to notify the upper layers. For each message, the upper layer has to register a notification callback, so that the lower layer can call it. So far, it is assumed there is only one notification callback.</p>
<p class="DocNodeLTR">On an other hand, USERDATA can notify the lower layers when som events occurs on the fifo, e.g.:</p><ul class="DocNodeLTR">
<li>&#x202A;an element is added in FIFO</li>
<li>&#x202A;an element is removed from fifo</li>
<li>&#x202A;the fifo is flushed This allows lower layers to maintain their internal control code and status code.</li>
</ul>
<h1 class="DocNodeLTR"><a class="anchor" id="user_data_design_points"></a>
Design/usage highlights</h1>
<h2 class="DocNodeLTR"><a class="anchor" id="user_data_design_point_cl"></a>
Chained list</h2>
<p class="DocNodeLTR">Depending on the radio link quality, some message added first in FIFO may not be received first on satellite, at first transmission. Some message will need several retransmission, some other will not. Thus, some later-added messages may be removed first from the FIFO.</p>
<p class="DocNodeLTR">For that purpose, the fifo is implemented as a chained list. A pointer to first element is available. Each element contains a pointer to next element. The last element of the fifo is point is pointing to NULL.</p>
<p class="DocNodeLTR">As each message is independent, the FIFO is internally designed as a chained list.</p>
<h2 class="DocNodeLTR"><a class="anchor" id="user_data_design_point_cs"></a>
Critical sections</h2>
<p class="DocNodeLTR">As this library is accessed by several software entities with different priorities, some critical sections may be needed in this library for data protection against dual access. Nevertheless, it is possible to avoid too much critical sections by clearly identify and separate variables in a way to get only one writer-reader path per variable.</p>
<p class="DocNodeLTR">Here is some examples:</p><ul class="DocNodeLTR">
<li>&#x202A;needs_transmit:<ul class="DocNodeLTR">
<li>&#x202A;write 0-&gt;1 by APP only</li>
<li>&#x202A;write 1-&gt;0 by APP only, after NW MGR sent notification to APP</li>
</ul>
</li>
<li>&#x202A;tx_rat: write by NW MGR only</li>
<li>&#x202A;nb_transmit:<ul class="DocNodeLTR">
<li>&#x202A;write 0-&gt;x by NW MGR only</li>
<li>&#x202A;write x-&gt;0 by RAT MGR only</li>
</ul>
</li>
</ul>
<h2 class="DocNodeLTR"><a class="anchor" id="user_data_design_point_es"></a>
Element size</h2>
<p class="DocNodeLTR">Depending on transmission protocol (KINEIS, NB-IOT, ...), the user data length can be different. Optimizing the memory resource with dynamic user data size in a chained list is difficult.</p>
<p class="DocNodeLTR">At first step, the data buffer will be an array where each element as the maximum size allowed among all protocols.</p>
<p class="DocNodeLTR">In next design iterations, two or three data size may be considered (e.g. bigger buffer for HDA4 data). This will lead the higher layer to reserve place in a buffer fitting its user-data length. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dc/d3f/main_page.html">&#x202A;Entry point: main</a></li><li class="navelem"><a class="el" href="../../db/d5a/kns_app_page.html">&#x202A;APP task</a></li><li class="navelem"><a class="el" href="../../d7/dcb/mgr_at_cmd_page.html">&#x202A;AT commands manager</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
